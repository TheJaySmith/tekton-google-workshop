apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: build-from-source
spec:
  resources:
    inputs:
      - name: git-repo
        type: git
  params:
    - name: pathToContext
      description: The path to the build context, used by Kaniko - within the workspace
      default: $(resources.inputs.git-repo.path)/Dockerfile
    - name: pathToDockerFile
      type: string
      description: The path to the dockerfile to build (relative to the context)
      default: Dockerfile
#    - name: imageUrl
#      description: Url of image repository
#    - name: imageTag
#      description: Tag to apply to the built image
#      default: "latest"
  steps:
    - name: build-and-push
      image: gcr.io/kaniko-project/executor
      command:
        - /kaniko/executor
      args:
        - --dockerfile=$(params.pathToDockerFile)
        - --destination=$(inputs.params.imageRegistry)/$(inputs.params.pathToProject)/$(outputs.resources.builtBaseImage.url)
       # - --context=/workspace/git-repo/$(params.pathToContext)
        - --context=$(params.pathToContext)